<html>

<head>
<title>WRF with HRRR</title>
<link rel="stylesheet" href="./css/brian_style.css" />
<script src="./js/site/siteopen.js"></script>
</head>


<body>
<a name="TOP"></a>
<script src="./js/site/sitemenu.js"></script>	

<div id="content">
    <h1 align="center">
    How to Initialize WRF with HRRR Boundary Conditions</h1>
  
  
  <!-- Tabs -->
  <ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#tab1">About</a></li>
    <li><a data-toggle="tab" href="#tab2">Download HRRR</a></li>
    <li><a data-toggle="tab" href="#tab3">Vtable</a></li>
    <li><a data-toggle="tab" href="#tab4">UNGRIB</a></li>
    <li><a data-toggle="tab" href="#tab5">METGRID</a></li>
    <li><a data-toggle="tab" href="#tab6">namelist.wps</a></li>
    <li><a data-toggle="tab" href="#tab7">namelist.input</a></li>
    <li><a data-toggle="tab" href="#tab8">Preliminary Results</a></li>
  </ul>

    <div class="tab-content">
        <div id="tab1" class="tab-pane fade in active">
                <h3>About the HRRR</h3>
                <center><img width="350px" style="padding:5px 15px 5px 5px" src="https://rapidrefresh.noaa.gov/hrrr/hrrrcrefimage"></center>
                <p>The High Resolution Rapid Refresh model, or HRRR, is a WRF based forecast model nested in the RUC model
                with a resolution of 3 km and outputs every hour. More info and current forecasts can
                be found on the <a href="http://ruc.noaa.gov/hrrr/"> homepage </a>
                and <a href="http://nomads.ncep.noaa.gov/txt_descriptions/HRRR_doc.shtml">NWS documentation</a>.
                The MesoWest group at the University of Utah has been archiving
                HRRR model output since April 2015 for various research purposes.
                To access the archive, click the folling link:
                <br>
                <center><a href='http://home.chpc.utah.edu/~u0553130/Brian_Blaylock/hrrr_FAQ.html' class='btn btn-lg btn-danger'>
                HRRR Archvie at the University of Utah</a></center>
                <br>
                <p>If you are trying to initalize WRF with HRRR model output, keep reading.
                <p>You can get the HRRR static fields, including HRRR's 
                raw geo_em data, 
                <a href="http://rapidrefresh.noaa.gov/HRRR/static/">here</a>.
                <p>More info about RUC and HRRR 
                <a href="http://ruc.noaa.gov/pdf/RAPv2-NWSwebinar-18feb2014-FINAL.pdf">here</a>
                and <a href="http://ruc.noaa.gov/pdf/HRRRv2-RAPv3-2015.png">here</a> 
                and <a href="http://ruc.noaa.gov/pdf/HRRR_status_July_2015.pdf">here</a>
                and <a href="http://ruc.noaa.gov/pdf/RAPHRRR_WCOSS_2016Q1_Final.pdf">here</a>.

                <img align='right' style="padding-left:15px;" src="./images/HRRR_ad.png" width="350px">
                <p>The sequence of tabs above describes how 
                <i>"even you can initialize WRF simulations with HRRR boundary conditions"</i>
                (said in your favorite infomercial voice).
                
                <p>Advantages of using HRRR include its hourly 3 km resolution state of the 
                atmosphere (as opposed to using NAM's 6-hourly, 12 km resolution) and its advanced
                data assimilation. We expect better initialization of WRF using the HRRR will improve simulations of thermally driven flows, 
                including slope flows and lake breezes, in the Salt Lake Valley.            
                <hr>
                <p>It would be to your benefit to review ESRL's static fields 
                        (namelists, Vtable, METGRID.TBL, geo_em.do1.nc, etc.)
                        for the different versions of the HRRR and RAP models below.
                        <center><form action="https://rapidrefresh.noaa.gov/HRRR/static/">
                                <input style="width:100px;" class="btn btn-primary" type="submit" value="HRRR Static" />
                                </form>   
                                <br>      
                                <form action="https://rapidrefresh.noaa.gov/RAP/static/">
                                <input style="width:100px;"  class="btn btn-primary" type="submit" value="RAP Static" />
                                </form>
                        </center>
                <hr>
                <p>External Links:
                <ul style="padding: 10px; margin-left:30px;">
                        <li><a href="http://ruc.noaa.gov/hrrr/">HRRR Homepage (ESRL)</a>
                        <li><a href="http://rapidrefresh.noaa.gov/HRRR/static/"> HRRR Static Fields (i.e. Vtable, namelist.wps, METGRID.TBL, etc.)</a>
                        <li><a href="http://ruc.noaa.gov/hrrr/namelist.wps.txt"> HRRR namelist.wps   (WPS)</a>
                        <li><a href="http://ruc.noaa.gov/hrrr/wrf.nl.txt">       HRRR namelist.input (WRF)</a>
                        <li><a href="http://rapidrefresh.noaa.gov/HRRRsmoke/"> HRRR Smoke</a>
                        <li><a href="http://ruc.noaa.gov/pdf/RAPHRRR_WCOSS_2016Q1_Final.pdf">HRRR v2 Description PDF</a>
                </ul>
        </div>

        <div id="tab2" class="tab-pane fade">
                <h3>Download HRRR data for WRF Boundary Conditions</h3>
                <p>Step 1: Get HRRR analyses.
                <p>You must get the full pressure field file. 
                You can get the current HRRR data from <a href="http://nomads.ncep.noaa.gov/">
                NOMADS</a>. 
                <p>Unfortunatly, historical HRRR data isn't archived by NCEP.
                At the University of Utah we started archiving HRRR data in April 2015.
                Parts of this archive are avialable publically, but only for 
                the few most current months. Please refer to the FAQ page for
                more information and for a link to download from the HRRR archive.

                <center><form action="./hrrr_FAQ.html">
                        <input class="btn btn-primary" type="submit" value="HRRR Archive FAQ" />
                </form></center>
                                
                <hr>
                <p>Raw HRRR data is in GRIB2 format. You will use WRF's WPS
                to prepare the HRRR analyses for WRF with the ungrib function.
                <p>There are several ways read and view GRIB2 files.
                You can print out the variable contents of the grib2 file by typing:
                <div class="well well-sm">wgrib2 -v <i>filename.grib2</i></div>
                <p>You can plot the grib2 data using the pygrib module. 
                Look at an example on github <a href="https://github.com/blaylockbk/Ute_other/blob/master/pygrib_HRRR_example.py">here</a>
                and <a href="https://github.com/blaylockbk/Ute_other/blob/master/plot_HRRR_analysis_gph_wind.py">here</a>.
                <p>You can also view the data with ncview if you convert the GRIB2 to NetCDF
                using <a href="http://www.cpc.ncep.noaa.gov/products/wesley/wgrib2/">wgrib2</a>.
                <div class="well well-sm">wgrib2 filename.grib2 -netcdf filename.nc<br>ncview filename.nc</div>
        </div>

        <div id="tab3" class="tab-pane fade">
                <h3>Vtable.hrrr</h3>
                <p>The Vtable in WPS tells ungrib how to index and extract 
                data from the grib2 file. I created a Vtable for the HRRR data
                you can copy and link in WPS. <a href="https://github.com/blaylockbk/Ute_WRF/blob/master/modificaions/Vtable.HRRR.bkb">Vtable.hrrr.bkb <i class="fa fa-github-square" aria-hidden="true"></i></a>.
                
                <p>I created this custom Vtable following the instructions in the <a href="http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_V3/users_guide_chap3.htm#_Creating_and_Editing">
                WRF User Guide</a>. I used the WPS utility <i>util/g2print.exe [name-of-grib2-file] > out.txt</i> to print out the contents and 
                create the custom Vtable based on the output. This version is different than 
                <a href="http://rapidrefresh.noaa.gov/HRRR/static/Vtable.HRRR.ESRL">ESRL's' verion</a>.
                <p>At any rate, my Vtable worked, but if you find errors or additions
                please forward those to me <i class="fa fa-smile-o" aria-hidden="true"></i>.
        </div>

        <div id="tab4" class="tab-pane fade">
                <h3>UNGRIB Requires JASPER Library</h3>
                <p>Raw HRRR files are in GRIB2 format. In order to ungrib these 
                files WPS requires the JASPER library. When you configure 
                WPS it should say 
                <span style="color:green">"Found Jasper environment variables
                for GRIB2 support..."</span>. Then configure WPS with a 
                "grib2 friendly" option. In WRFv3.7 I use option 
                <span style="color:red">7. Linux x86_64, PGI comiler (dmpar)</style>
                
                <p>If you are on the University of Utah's CHPC computers,
                set these environments:
                <div class="well well-sm">
                setenv JASPERLIB /uufs/chpc.utah.edu/sys/installdir/jasper/1.900.1-atmos07102015/lib<br>
                setenv JASPERINC /uufs/chpc.utah.edu/sys/installdir/jasper/1.900.1-atmos07102015/include
                </div>
                
                <p>If you don't have JASPER, see
                <a href="http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_V3/users_guide_chap3.htm"> 
                Chapter 3 of the WRF User Guide</a> for instructions to install JASPER.
                                                
                <hr>
                <h3>Trying to UNGRIB with HRRR-Alaska?</h3>
                <p>There is an update to the rd_grib2.F file (WPS/ungrib/src/rd_grib2.F) that will allow you to ungrib 
                the experimental Alaska HRRR data. You should be able to use the regular HRRR without this, but it
                doesn't hurt to give it a try. The reason this is necessary for Alaska HRRR grib files is that
                Alaska HRRR data is on a polar stereograph projection, and processing for that type of projection is included in the updated script. 
                <p><a href='http://home.chpc.utah.edu/~u0553130/HRRR_WRF/rd_grib2_for-ungribbing-HRRR-alaska.F.txt'>GET THIS FILE</a>
        </div>

        <div id="tab5" class="tab-pane fade">
                <h3>METGRID.TBL</h3>
                <p>The METGRID Table tells METGRID how to interpolate the 
                meteorological fields from the UNGRIBed files on the WRF friendly grid.
                <a href="https://github.com/blaylockbk/Ute_WRF/blob/master/modificaions/METGRID.TBL.HRRR.bkb">METGRID.TBL.hrrr.bkb <i class="fa fa-github-square" aria-hidden="true"></i></a>
                <p>If you find errors or have any suggestions please share <i class="fa fa-smile-o" aria-hidden="true"></i>.
        </div>

        <div id="tab6" class="tab-pane fade">
                <h3>namelist.wps</h3>
                <p><img src = 'http://home.chpc.utah.edu/~u0553130/HRRR_WRF/model_domains.png' style="width:90%; max-width:500px" class='style1'>
                <p>Above shows the HRRR terrain height with water area colored blue. 
                Domain 1 (d01) has a grid spacing of 3km, same as the HRRR. 
                Domain 2 (d02) has a grid spacing of 1km.
                <p>Download: <a href="http://home.chpc.utah.edu/~u0553130/HRRR_WRF/namelist.wps.bkb.txt">namelist.wps.bkb</a>
        </div>

        <div id="tab7" class="tab-pane fade">
                <h3>namelist.input</h3>
                <p>This is my namelist.input file used to run real.exe and wrf.exe
                <p>Download: <a href="http://home.chpc.utah.edu/~u0553130/HRRR_WRF/namelist.input.bkb">namelist.input.bkb</a>
        </div>

        <div id="tab8" class="tab-pane fade">
                <img align=right height="200" style="min-width:150px; padding:3px;" src="http://home.chpc.utah.edu/~u0553130/HRRR_WRF/subdomain_salt-lake-valley.png">
                <h3>Comparing HRRR 3km with WRF 1km</h3>
                <p> My <a href="./MS.html">master's thesis</a> used thed described method
                to initialize WRF with the HRRR to study a lake breeze event.
                While that project didn't explore the benefits of using HRRR
                as boundary conditions instead of the NAM or GFS, here is one 
                example of differences between the HRRR and the 1 km WRF simulation.
                <p>Below compares the winds for the Salt Lake Valley subset from
                the HRRR analysis and the WRF model at 1 km initialized by the
                HRRR analysis. Notice the difference in the outline of the Great Salt Lake (blue)
                between HRRR and WRF. This was a custom modification described 
                in my thesis. The observations from the TDWR is also shown.
                The lake breeze in the HRRR never progressed, probably due to 
                ineffective data assimilation. The WRF simulated lake breeze
                was strong an early probably because of the lack of strong
                southerly winds. This is described in my these. Good thing 
                my method didn't fix everything or we'd all be out of a job.
                <center><img align=center width="85%" style="max-width:600px; padding:3px;" src="./images/Example_Model_Winds.png"></center>
        </div>


    </div>



	<br>
	<div class="well">
		<i class="fa fa-book fa-fw" aria-hidden="true"></i> 
		This work was used in 
		<a style="color:#990000;font-weight:700;" href=http://journals.ametsoc.org/doi/abs/10.1175/JAMC-D-16-0216.1 target="_blank">Blaylock et al. 2017</a>
	</div>
</div>
<script src="./js/site/siteclose.js"></script>
</body>
</html>